<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Supabase - –û–∫–æ—à–∫–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8 max-w-4xl">
        <h1 class="text-3xl font-bold text-center mb-8">üéâ –¢–µ—Å—Ç Supabase –¥–ª—è –û–∫–æ—à–∫–æ</h1>
        
        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div id="status" class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</h2>
            <div id="connection-status" class="text-gray-600">
                <span class="animate-pulse">‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–£—Å–ª—É–≥–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</h2>
            <div id="services-list" class="space-y-2">
                <span class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —É—Å–ª—É–≥—É:</h2>
            <form id="add-service-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏</label>
                    <input type="text" id="service-name" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –§—Ä–µ–Ω—á">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                        <input type="number" id="service-price" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="2000">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)</label>
                        <input type="number" id="service-duration" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="60">
                    </div>
                </div>
                <button type="submit" 
                        class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                    –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
                </button>
            </form>
            <div id="form-result" class="mt-4"></div>
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
            <h3 class="text-lg font-semibold mb-2">üìù –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:</h3>
            <ol class="list-decimal list-inside space-y-1 text-gray-700">
                <li>–°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Supabase"</li>
                <li>–î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –¥–µ–º–æ-—É—Å–ª—É–≥–∏ –∏–∑ –±–∞–∑—ã</li>
                <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —É—Å–ª—É–≥—É —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É</li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É: <a href="http://localhost:3000" class="text-blue-600 underline">http://localhost:3000</a></li>
            </ol>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const { createClient } = supabase;
        const supabaseUrl = 'http://localhost:8000';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0';
        
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function checkConnection() {
            const statusDiv = document.getElementById('connection-status');
            try {
                const { data, error } = await supabaseClient
                    .from('services')
                    .select('count')
                    .limit(1);
                
                if (error) throw error;
                
                statusDiv.innerHTML = '<span class="text-green-600 font-semibold">‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Supabase!</span>';
                loadServices();
            } catch (error) {
                statusDiv.innerHTML = `<span class="text-red-600">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}</span>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥
        async function loadServices() {
            const listDiv = document.getElementById('services-list');
            try {
                const { data, error } = await supabaseClient
                    .from('services')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                if (data.length === 0) {
                    listDiv.innerHTML = '<span class="text-gray-500">–ù–µ—Ç —É—Å–ª—É–≥ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</span>';
                } else {
                    listDiv.innerHTML = data.map(service => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                            <div>
                                <span class="font-medium">${service.name}</span>
                                <span class="text-sm text-gray-500 ml-2">${service.duration} –º–∏–Ω</span>
                            </div>
                            <span class="text-purple-600 font-bold">${service.price}‚ÇΩ</span>
                        </div>
                    `).join('');
                }
            } catch (error) {
                listDiv.innerHTML = `<span class="text-red-600">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}</span>`;
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏
        document.getElementById('add-service-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('form-result');
            resultDiv.innerHTML = '<span class="text-gray-500">–î–æ–±–∞–≤–ª—è–µ–º...</span>';
            
            // –ü–æ–ª—É—á–∞–µ–º ID –º–∞—Å—Ç–µ—Ä–∞
            const { data: masters } = await supabaseClient
                .from('masters')
                .select('id')
                .limit(1);
            
            if (!masters || masters.length === 0) {
                resultDiv.innerHTML = '<span class="text-red-600">–ù–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ –≤ –±–∞–∑–µ</span>';
                return;
            }
            
            const serviceData = {
                master_id: masters[0].id,
                name: document.getElementById('service-name').value,
                price: parseInt(document.getElementById('service-price').value),
                duration: parseInt(document.getElementById('service-duration').value),
                category: 'other',
                is_active: true
            };
            
            try {
                const { data, error } = await supabaseClient
                    .from('services')
                    .insert(serviceData)
                    .select();
                
                if (error) throw error;
                
                resultDiv.innerHTML = '<span class="text-green-600">‚úÖ –£—Å–ª—É–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!</span>';
                document.getElementById('add-service-form').reset();
                loadServices();
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600">–û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        });

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        checkConnection();
    </script>
</body>
</html>